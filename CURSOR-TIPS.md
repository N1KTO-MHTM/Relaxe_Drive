# Cursor: как реже получать ошибку «oom» (Out of Memory)

Чтобы окно Cursor **не крашилось** с **«The window terminated unexpectedly (reason: 'oom')»**, ниже — расширенная памятка.

---

## 0. Сейчас на экране OOM (reason: 'oom', code: '-536870904')?

1. **Поставьте галочку «Don't restore editors»** — иначе при Reopen откроются все старые вкладки и память снова кончится.
2. Нажмите **Reopen**.
3. После открытия: закройте лишние вкладки (оставьте 3–5), не открывайте тяжёлые файлы все сразу.

**Если OOM всё равно повторяется:** закройте Cursor, откройте его снова и откройте **не весь проект, а одну папку** — **File → Open Folder** → выберите папку **`web`** (если работаете с фронтом) или **`backend`** (если с API). Так Cursor индексирует в разы меньше — это самый эффективный способ избавиться от падений.

---

## 1. Сразу после сбоя (при перезапуске)

- **Включите «Don't restore editors»** — не восстанавливать вкладки. Так Cursor не будет открывать десятки файлов и тратить память.
- Нажмите **«Reopen»** только после того, как поставили галочку. Если нажмёте «Reopen» без галочки, все старые вкладки снова откроются и память может снова закончиться.
- Если Cursor снова падает при открытии — закройте его полностью, откройте заново и при первом диалоге обязательно отметьте **«Don't restore editors»**.
- **Перед повторным открытием:** закройте все другие окна Cursor и по возможности освободите RAM (закройте браузер, тяжёлые приложения).

---

## 2. В этом проекте (Relaxe Drive)

- В корне добавлен **`.cursorignore`**: Cursor меньше индексирует `node_modules`, `dist`, миграции, lock-файлы, кэш и т.п. — нагрузка на память ниже. Файл расширен (добавлены `*.tsbuildinfo`, `coverage`, `.cursor/projects` и др.).
- **Тяжёлые файлы (не держите несколько открытыми сразу):**
  - `web/src/pages/dashboard/Dashboard.tsx` — самый большой, после правок закрывайте вкладку;
  - `web/src/pages/passengers/Passengers.tsx`, `web/src/components/OrdersMap.tsx`, `backend/src/orders/orders.service.ts` — тоже крупные; открывайте по одному.
- **Поиск по проекту:** если ищете по всему проекту (Ctrl+Shift+F), после поиска закройте панель поиска — большие результаты тоже занимают память.
- **Терминал:** не держите в одном окне десятки терминалов; лишние закройте.
- **Открывать только нужную часть:** если работаете только с **web** или только с **backend** — откройте в Cursor папку `web` или `backend`, а не весь «Relaxe Drive». Так индексации меньше и крашей меньше.
- **Локали (en/ru/es/ka):** не открывайте все четыре JSON сразу — при необходимости откройте один, закройте после правок.
- **Не открывайте** сгенерированные файлы: `vite.config.js`, `*.tsbuildinfo`, файлы из `node_modules`.

---

## 3. Настройки и привычки в Cursor

- **Закрывайте лишние окна Cursor.** Каждое окно с проектом — отдельная нагрузка на память.
- **Закрывайте ненужные вкладки редактора.** Оставляйте открытыми только то, с чем работаете сейчас (в идеале 3–5 вкладок).
- **Не открывайте в Cursor очень тяжёлые папки** (например, целый диск или папку с тысячами файлов не по коду).
- **Chat / Composer:** длинные диалоги с большим контекстом тоже едят память. Если чат стал очень длинным — **начните новый разговор** (New Chat), старый можно не удалять, но не держите его активным.
- **Отключите лишние расширения** (Extensions): каждое расширение может потреблять память. Оставьте только то, чем пользуетесь.
- **Файлы из `node_modules`** не открывайте в редакторе — они уже в `.cursorignore`, но случайное открытие большого файла из зависимостей может подвесить окно.
- **Превью изображений:** не открывайте в редакторе много больших картинок сразу — это тоже грузит память.

---

## 4. Система (Windows)

- **Закройте другие тяжёлые приложения:** много вкладок в Chrome/Edge, вторая IDE (VS Code, WebStorm), игры, видеоредакторы. Всё это делит RAM с Cursor.
- **Проверьте, что не висит «забытых» процессов Cursor:** Диспетчер задач (Ctrl+Shift+Esc) → вкладка «Подробности» или «Процессы» → найдите «Cursor». Если после закрытия остались процессы — завершите их, чтобы освободить память.
- **Если на ПК мало RAM (8 GB и меньше):**
  - работайте в Cursor с **одним проектом**;
  - при перезапуске всегда выбирайте **«Don't restore editors»**;
  - закрывайте браузер или другие программы на время работы в Cursor;
  - не держите открытыми больше 5–7 вкладок в Cursor.
- **Виртуальная память (файл подкачки):** убедитесь, что на системном диске включён файл подкачки (Параметры → Система → О программе → Дополнительные параметры системы → Быстродействие → Параметры → Дополнительно → Виртуальная память). Это не ускорит Cursor, но может уменьшить падения с oom при нехватке RAM.
- **Один диск C:** если проект на OneDrive/облаке — синхронизация может дополнительно грузить диск и память. По возможности работайте с копией на локальном диске.

---

## 5. Если oom всё равно появляется

- Откройте **только** папку `web` или `backend` в Cursor вместо всего репозитория.
- Перезапустите компьютер: иногда память забита остатками других приложений.
- Обновите Cursor до последней версии — в новых версиях иногда улучшают потребление памяти.
- Напишите в поддержку Cursor (или на форум), приложив текст ошибки и код `-536870904` — так разработчики могут учитывать такие кейсы.
- **Отключите индексацию для больших папок:** в Cursor можно исключить папки через `.cursorignore` — мы уже добавили туда максимум лишнего.

---

## 6. Чек-лист перед долгой работой (чтобы не крашнулось)

- [ ] Закрыты лишние вкладки (оставлено не больше 5–7).
- [ ] Закрыты другие окна Cursor.
- [ ] В .cursorignore добавлены тяжёлые папки (уже сделано в проекте).
- [ ] Браузер или другие тяжёлые приложения закрыты или свёрнуты.
- [ ] Если раньше был oom — при следующем открытии буду ставить «Don't restore editors».

---

## Кратко

| Что делать | Зачем |
|------------|--------|
| «Don't restore editors» при перезапуске | Меньше открытых файлов → меньше RAM |
| 3–7 вкладок, не больше | Меньше данных в памяти |
| Один проект / одно окно Cursor | Меньше индексации и процессов |
| Закрыть браузер и тяжёлые приложения | Больше свободной RAM для Cursor |
| `.cursorignore` в проекте (расширен) | Меньше файлов индексируется |
| Новый чат при длинном диалоге | Меньше контекста в памяти |
| Открыть только `web` или `backend` | Ещё меньше индексации |

Ошибка **oom** связана с нехваткой памяти у самого Cursor, а не с кодом Relaxe Drive. Эти шаги снижают вероятность сбоя; при малом объёме RAM падения могут стать реже, но не исчезнуть полностью.

---

## 7. Память в приложении (браузер / Relaxe Drive)

- **Дашборд:** таймеры и опросы (водители, отчёты, время) при **скрытой вкладке** не обновляют состояние — меньше нагрузка на память и CPU, когда вкладка в фоне.
- **Маршруты** уже подгружаются лениво (lazy), тяжёлые страницы не все в памяти сразу.
- Если в **Cursor** по-прежнему oom — добавьте в конец `.cursorignore` вручную строки: `**/*.map`, `**/yarn.lock`, `build/`, `**/build/`, `.cursor/`, чтобы уменьшить индексацию.
