# RelaxDrive — GUI, вкладки и развитие функционала (7 направлений)

Глубокий анализ того, что можно автоматизировать, улучшить и добавить с упором на **интерфейс (GUI/UI), вкладки и функциональность**.

---

## 1. Risky events (безопасность водителя)

**Цель:** как на референс-скрине — бейдж «1 Risky Event» по поездке и сводка по водителю.

**Что сделать:**
- **Бэкенд:** модель/таблица событий по поездке (тип: harsh_braking, speeding, rapid_acceleration и т.д.), привязка к `DriverTripSummary` или к заказу. Опционально — интеграция с телематикой/внешним API.
- **Автоматизация:** при завершении поездки или в фоне анализировать трек (если будет храниться) или принимать вебхуки от телематики и писать события.
- **GUI:** в карточке поездки — бейдж «Risky events: N» (пока 0); во вкладке «Driver information» — сводка «Risky events за период» и, при клике, список по поездкам.

**Приоритет:** средний (сначала заглушка в UI, потом интеграция с данными).

---

## 2. Карта маршрута в карточке поездки

**Цель:** мини-карта или ссылка «View route» в стиле референса.

**Что сделано / сделать:**
- **Сделано:** в карточке поездки можно добавить ссылку «View route» → Google Maps (pickup → dropoff). Без хранения полилинии этого достаточно для быстрого просмотра.
- **Улучшение:** при завершении заказа сохранять полилайн маршрута (массив координат) в `Order` или в `DriverTripSummary`; в UI — мини-карта (Leaflet) с треком в карточке поездки.

**Автоматизация:** полилайн можно получать при завершении поездки (текущий маршрут из приложения водителя) или строить по адресам через геосервис.

**Приоритет:** высокий для ссылки «View route»; средний для мини-карты с треком.

---

## 3. Средняя скорость по поездке

**Цель:** отображать «31 mph» в карточке поездки.

**Что сделать:**
- **Расчёт:** средняя скорость = distance / time. Данные уже есть: `startedAt`, `completedAt`, `distanceKm` в `DriverTripSummary`. Можно считать на фронте и/или сохранять в БД при завершении заказа.
- **Бэкенд (опционально):** поле `averageSpeedKmh` в `DriverTripSummary`; при создании записи — считать и сохранять.
- **GUI:** в карточке поездки — строка «Avg speed: X mph» (конвертация из км/ч при необходимости).

**Приоритет:** высокий (простое улучшение, уже реализуемо на фронте).

---

## 4. Расширенная история и экспорт

**Цель:** фильтр по датам, экспорт в CSV/PDF.

**Что сделать:**
- **Бэкенд:** `GET /users/:id/trip-history?from=&to=` — фильтр по периоду (сейчас только последние 7 дней). Опционально — расширить хранение истории дольше 7 дней (настройка или отдельная «архивная» таблица).
- **GUI:** во вкладке «Trip history» — выбор периода (даты from/to); кнопка «Export CSV» — выгрузка текущего списка поездок (дата, маршрут, время, дистанция, заработок, средняя скорость).
- **Автоматизация:** по расписанию (cron) — генерация отчёта за неделю/месяц и отправка на email или сохранение в файловое хранилище (низкий приоритет).

**Приоритет:** высокий для Export CSV и фильтра по датам (после расширения API).

---

## 5. Уведомления и напоминания

**Цель:** не пропускать события (назначение заказа, новый заказ, завершение).

**Что уже есть:** WebSocket-алерты на дашборде; напоминание о подаче (`reminder_pickup_soon`) по cron.

**Что добавить:**
- **Browser:** Push-уведомления (если вкладка в фоне) при новом заказе / назначении.
- **Email (опционально):** письмо водителю при назначении; диспетчеру — при новом заказе.
- **GUI:** настройки в профиле или в админке — «Уведомления: Push / Email» вкл/выкл.

**Приоритет:** средний.

---

## 6. Календарь и выбор водителя — связка с деталями водителя

**Цель:** при выборе водителя в календаре открывать его детали (инфо, поездки, заработок).

**Что сделать:**
- **Сделано:** в календаре есть выбор водителя; при выборе показывается его расписание.
- **Улучшение:** кнопка/ссылка «View driver details» → переход на страницу Drivers с открытой панелью этого водителя (`/drivers?open=<userId>`). На странице Drivers — при загрузке читать `open` из URL и автоматически открывать панель и вкладки.

**Приоритет:** высокий (уже заложено в текущей задаче).

---

## 7. Аналитика по водителям

**Цель:** дашборд «топ по заработку / по количеству поездок / по милям».

**Что сделать:**
- **Бэкенд:** `GET /analytics/drivers` или агрегация в существующем API — список водителей с полями `totalEarningsCents`, `totalMiles`, `tripsCount` (из DriverStats + количество записей DriverTripSummary за период или всего).
- **GUI:** на странице Drivers — блок «Summary» или вкладка «Analytics»: таблица/карточки «Top drivers by earnings», «Top by trips», «Total miles». Фильтр по периоду (неделя / месяц).

**Автоматизация:** кэширование агрегатов (например, раз в час) для быстрой отдачи без тяжёлых запросов к БД.

**Приоритет:** средний.

---

## Фокус на GUI и вкладках

### Уже сделано
- **Дашборд — панель Drivers:** компактные карточки с именем, телефоном, авто, Driver ID, статус (Location on / Busy / Offline). Прокручиваемый список, раздельный блок Alerts.
- **Страница Drivers:** таблица водителей; при выборе — панель с вкладками **Driver information**, **Trip history**, **Earnings**. Карточки поездок в стиле референса (маршрут, время, дистанция, длительность, заработок).
- **Календарь:** выбор водителя, фильтр поездок по водителю, переведённые статусы заказов.

### Планируемые улучшения UI
1. **Единообразие вкладок:** везде, где есть табы (Drivers detail, Calendar по смыслу, будущая Analytics) — один стиль: подчёркивание активного, контраст, доступность (клавиатура, aria).
2. **Панель Drivers на дашборде:** клик по карточке водителя → переход на `/drivers?open=<id>` с открытой панелью этого водителя.
3. **Календарь:** при выбранном водителе — кнопка «View driver details» → `/drivers?open=<id>`.
4. **Карточка поездки:** средняя скорость, ссылка «View route» (Google Maps), бейдж «Risky events» (0 пока); кнопка «Export CSV» во вкладке Trip history.
5. **URL state:** страница Drivers открывает панель по `?open=<userId>`, чтобы можно было дать ссылку «детали водителя X».
6. **Аналитика:** блок или вкладка на странице Drivers с топом по заработку/поездкам (после появления API).

---

## Краткая матрица

| # | Направление              | Автоматизация                    | GUI/вкладки                          | Статус        |
|---|--------------------------|-----------------------------------|--------------------------------------|---------------|
| 1 | Risky events             | Телематика/вебхуки, расчёт при завершении | Бейдж в карточке, сводка в профиле   | Заглушка UI   |
| 2 | Карта в карточке поездки | Полилайн при завершении/геосервис | Ссылка «View route», затем мини-карта| Ссылка сделана|
| 3 | Средняя скорость         | Расчёт при завершении или на фронте | Строка «X mph» в карточке            | Реализуемо    |
| 4 | История и экспорт        | API from/to, cron-отчёты опционально | Фильтр дат, Export CSV               | CSV + API     |
| 5 | Уведомления              | Push, email                       | Настройки в профиле                  | Планируется   |
| 6 | Календарь → детали водителя | —                               | Кнопка «View driver details», URL open= | В работе    |
| 7 | Аналитика водителей     | Кэш агрегатов                     | Блок Summary / вкладка Analytics     | После API     |

Этот документ можно обновлять по мере реализации пунктов.
