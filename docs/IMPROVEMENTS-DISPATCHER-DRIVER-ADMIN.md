# Улучшения для диспетчера, водителя и админа

## Сделано

### Диспетчер
- **Сводка по заказам:** над списком активных заказов отображаются «Без водителя: N» и «Под риском: M» (если есть такие заказы).
- **Одна кнопка «Назначить предложенного»:** если у заказа есть предложенный водитель (planning), диспетчер может назначить его одним кликом, без выбора из списка.
- **Удаление поездки:** кнопка «Удалить» в карточке заказа с подтверждением (уже было).
- **Фокус на заказе, задержка, ручное назначение:** кнопки «Фокус», «+5 / +10 мин», «Ручное назначение» для заказов с риском.

### Водитель
- **«Поездок сегодня: N»:** над списком активных заказов водитель видит количество своих поездок на сегодня.
- Карта только с отчётами, навигация в Google Maps/Waze, линия пройденного пути, отображение mph / «здесь N мин» (уже было).

### Админ
- Те же возможности, что и у диспетчера, плюс: Роли, Сессии, Контроль затрат, White Label, Аудит, Здоровье системы (уже было).
- Алерты о превышении лимитов затрат (cost_limit_exceeded) раз в час (уже было).

### Автоматизация (бэкенд)
- **Напоминания о посадке:** каждые 5 минут — напоминания по заказам с посадкой в ближайшие N минут (reminder_pickup_soon). Окно задаётся через **PICKUP_REMINDER_MINUTES** (по умолчанию 15). См. `backend/.env.example`.
- **Planning:** каждые 5 минут пересчёт рисков и предложенных водителей, рассылка planning.update. Если есть рисковые заказы — диспетчеру отправляется алерт **planning.risky_unassigned** (N рисковых заказов).
- **Статистика водителей:** раз в час пересчёт idleAvg, lateRate, rejectRate.
- **Лимиты затрат:** раз в час проверка и алерт при превышении.
- **Очистка:** раз в день — старые сессии (90 дней), старые DriverTripSummary (7 дней).

### Звук и алерты
- **Звуковой сигнал:** при появлении браузерного уведомления (новый заказ для диспетчера, назначение для водителя, напоминание о посадке) проигрывается короткий звук (Web Audio API).
- **Алерт «рисковые заказы»:** в блоке «Оповещения» отображается «N рисковых заказов без водителя» после каждого цикла планирования, если такие заказы есть.

### Скрипты из корня
- **npm run check-locales** — проверка ключей локалей (web).
- **npm run db:generate** — генерация Prisma-клиента (backend).
- **npm run db:migrate** — миграции (backend).
- **npm run db:studio** — Prisma Studio (backend).

---

## Что можно добавить дальше

### Диспетчер
- Массовые действия: выбрать несколько заказов → назначить одного водителя или отменить выбранные.
- Экспорт заказов за день/неделю (CSV/Excel).
- Быстрые фильтры: «Без водителя», «Посадка в течение часа», «Под риском».

### Водитель
- Краткий список «Мои поездки на сегодня» с временем посадки (уже частично: список заказов + «Поездок сегодня: N»).
- Кнопка «Я через 5 минут» (отправка ETA пассажиру/диспетчеру) или отображение ETA из системы.

### Админ
- Сводка на дашборде: заказов сегодня, активных водителей, заказов без водителя.
- В аудите — фильтр по пользователю и типу действия.
- В контроле затрат — предупреждение при приближении к лимиту (не только при превышении).
- Массовые действия по пользователям: блокировка/разблокировка нескольких водителей.

### Автоматизация
- Опциональное автоназначение: за X минут до посадки автоматически назначать предложенного водителя, если заказ ещё без водителя (выключаемая настройка или env).
- Настраиваемое окно напоминаний о посадке (сейчас 15 минут) через env.
- Алерт диспетчеру при появлении рискового заказа без водителя (например, planning.risky_unassigned с количеством).

Если нужно реализовать что-то из списка — можно выбрать пункты по приоритету.
