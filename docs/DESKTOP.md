# Desktop Control Center — программа, которая всем управляет

Десктопное приложение **RelaxDrive Control Center** — это программа на твоём компьютере, которая подключается к тому же API, что и веб-дашборд, и даёт доступ к режимам управления в одном окне.

---

## Что умеет Desktop

- **Control Mode** — основной режим: карта, заказы, водители, алерты (как дашборд в одном окне).
- **Live Wall** — «стена» для мониторинга в реальном времени.
- **System Health** — состояние системы: API, WebSocket, БД, карты, перевод, AI, очереди, задержки.
- **Logs & Audit** — логи и аудит событий, фильтры, экспорт.
- **Вход** — те же логин/пароль, что и в вебе (Admin, Disp1, Driver1 и т.д.).

Всё управление идёт через один backend (например `https://relaxdrive-api.onrender.com`). Desktop — просто ещё один клиент к нему.

---

## Как запустить

### 1. Установка и сборка

```bash
cd desktop
npm install
```

### 2. Подключение к прод API (Render)

Создай в папке `desktop` файл **`.env`**:

```env
VITE_API_URL=https://relaxdrive-api.onrender.com
VITE_WS_URL=https://relaxdrive-api.onrender.com
```

Без `.env` приложение по умолчанию обращается к `http://localhost:3000` (локальный backend).

### 3. Запуск

**Вариант A — dev (Vite + Electron):**

Сначала собери фронт и запусти Electron:

```bash
npm run dev
```

Если в `electron/main.ts` в dev загружается `http://localhost:5174`, предварительно в другом терминале запусти Vite:

```bash
npx vite
```

(порт в `vite.config.ts` для desktop должен быть 5174, если так настроено в main.)

**Вариант B — один раз собрать и открывать exe:**

```bash
npm run build
npm run start
```

**Установщик Windows (.exe):**

```bash
npm run build:win
```

Готовое приложение и установщик (NSIS) появятся в папке `desktop/dist-electron`. В `.env` укажи прод API (`VITE_API_URL`, `VITE_WS_URL`) перед сборкой, чтобы установленная программа ходила на Render.

---

## Кто что видит в Desktop

Те же роли, что и в вебе:

- **Admin** — все режимы (Control, Live Wall, System Health, Logs & Audit).
- **Dispatcher** — те же режимы (без админ-функций на бэкенде).
- **Driver** — логин возможен; в текущей версии интерфейс общий, ограничения по API те же, что в вебе.

Рекомендуется использовать Desktop под учёткой **Admin** или **Disp1**, чтобы управлять заказами и смотреть здоровье системы.

---

## Кратко

| Действие | Команда / файл |
|----------|-----------------|
| Подключить к Render API | В `desktop/.env`: `VITE_API_URL=https://relaxdrive-api.onrender.com` |
| Запустить приложение | `cd desktop` → `npm run dev` (или `npm run build` и `npm run start`) |
| Собрать exe для Windows | `npm run build:win` |
| Вход | Те же логин/пароль, что в вебе (Admin / Luka1Soso, Disp1 / Luka1Soso) |

Desktop — это **программа, которая всем управляет**: один клиент к общему API, те же заказы, сессии и здоровье системы, что и в веб-дашборде.

---

## Что улучшили

- **Единая навигация** — вкладки Control Mode, Live Wall, System Health, Logs & Audit вынесены в общий layout; активная вкладка подсвечивается.
- **Кнопка «Выйти»** — в шапке справа; очищает сессию и перенаправляет на страницу входа.

---

## Что можно добавить или улучшить

| Что | Описание |
|-----|----------|
| **Control Mode** | Сейчас заглушка. Добавить: карту, список заказов, водителей, календарь, алерты (как в веб-дашборде) или iframe/встроенный вид веб-дашборда. |
| **Live Wall** | Сейчас заглушка. Добавить: полноэкранную карту, ETA, алерты в реальном времени (WebSocket), вид для большого экрана. |
| **System Health** | Работает: запрос `/health`, отображение database, websocket, redis, maps, ai. Можно: авто-обновление по таймеру, индикатор «последнее обновление», предупреждение при ошибке API. |
| **Logs & Audit** | Сейчас заглушка. Нужно: запрос к API аудита (если есть), таблица событий, фильтры по пользователю/действию/дате, экспорт CSV/JSON. |
| **Роли в UI** | Показывать в шапке текущего пользователя (никнейм, роль); скрывать или дизейблить вкладки по ролям (как в вебе). |
| **Язык** | Переключатель языка (EN/RU/KA) в шапке или в настройках. |
| **Офлайн / ошибка API** | При недоступности API показывать сообщение и кнопку «Повторить»; не падать на ошибках сети. |
| **Автообновление токена** | Если бэкенд отдаёт refresh token, по истечении access token тихо обновлять его, чтобы не выкидывать пользователя. |
